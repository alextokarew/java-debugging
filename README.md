# java-debugging
Java debugging examples

TODO: investigate gradle run option `--debug-jvm`

# JDB examples

```commandline
./gradlew build
jdb -sourcepath app/src/main/java -classpath app/build/classes/java/main com.github.alextokarew.javadebugging.jdb.DebugDemo
```

```jdb
stop at com.github.alextokarew.javadebugging.jdb.DebugDemo.main
run
next
!! (x2)
locals
dump calc
step
watch com.github.alextokarew.javadebugging.jdb.Calculator.multiplier
next (to multiply method)
step (into multiply)
where
eval value * 3
set value = 20
cont 
where
cont
```

# Code generation debugging

## Autogenerated bytecode debugging

OpenJDK debug build (./configure --enable-debug) supports JVM flags for bytecode tracing:
`-XX:+TraceBytecodes`

### With JDB

```commandline
jdb -sourcepath app/src/main/java:app/src/main/exprs \
    -classpath app/build/classes/java/main/ \
    com.github.alextokarew.javadebugging.codegen.BytecodeDebugging
```

```jdb
stop at com.github.alextokarew.javadebugging.codegen.BytecodeDebugging:37
run 

stepi (x4)
wherei

list
```

# Multithread debugging

## Deadlocks

```commandline
java -cp app/build/classes/java/main -agentlib:jdwp="transport=dt_socket,server=y,suspend=n,address=*:5006" \
      com.github.alextokarew.javadebugging.multithreaded.Deadlocks
jdb -sourcepath app/src/main/java -attach localhost:5006
```

```jdb
threads
thread 727
where

```

## Races

```commandline
jdb -sourcepath app/src/main/java -classpath app/build/classes/java/main com.github.alextokarew.javadebugging.multithreaded.Races
```

```jdb
stop thread at com.github.alextokarew.javadebugging.multithreaded.Races:12
run
threads
suspend <thread id 2>
thread <thread id 1>
stepi (x3)
print counter
suspend <thread id 1>
thread <thread id 2>
resume <thread id 2>
stepi (x3)
print counter
resume <thread id 1>
cont
```

# FFM API debugging

## Building and running

At the project root:
```bash
./gradlew clean build
cd app/
java -cp build/classes/java/main --enable-native-access=ALL-UNNAMED \
     -agentlib:jdwp="transport=dt_socket,server=y,suspend=y,address=*:5005" \
     com.github.alextokarew.javadebugging.ffm.FibFFM
gdb --pid $JAVA_PROCESS_PID
jdb -attach 5005
```

```gdb
break fibonacci
continue
# -----------------
break +4
continue (x3)
info locals
set old_result=123
del
continue
```

```jdb
# -----------------
stop in com.github.alextokarew.javadebugging.ffm.FibFFM:18
run
# -----------------
locals
cont
```