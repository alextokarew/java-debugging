# java-debugging
Java debugging examples

TODO: investigate gradle run option `--debug-jvm`

# JDB examples

```commandline
./gradlew build
jdb -sourcepath app/src/main/java -classpath app/build/classes/java/main com.github.alextokarew.javadebugging.jdb.DebugDemo
```

```jdb
stop at com.github.alextokarew.javadebugging.jdb.DebugDemo.main
run
next
!! (x2)
locals
dump calc
step
watch com.github.alextokarew.javadebugging.jdb.Calculator.multiplier
next (to multiply method)
step (into multiply)
where
eval value * 3
set value = 20
cont 
where
cont
```

# Code generation debugging

## Autogenerated bytecode debugging

OpenJDK debug build (./configure --enable-debug) supports JVM flags for bytecode tracing:
`-XX:+TraceBytecodes`

### With JDB

```commandline
jdb -sourcepath app/src/main/java:app/src/main/exprs \
    -classpath app/build/classes/java/main/ \
    com.github.alextokarew.javadebugging.codegen.BytecodeDebugging
```

```jdb
stop at com.github.alextokarew.javadebugging.codegen.BytecodeDebugging:37
run 

stepi (x4)
wherei

list
```

# Multithread debugging

## Deadlocks

```commandline
java -cp app/build/classes/java/main -agentlib:jdwp="transport=dt_socket,server=y,suspend=n,address=*:5006" \
      com.github.alextokarew.javadebugging.multithreaded.Deadlocks
jdb -attach localhost:5006
```

```jdb
threads
thread 727
where

```

## Races

```commandline
jdb -sourcepath app/src/main/java -classpath app/build/classes/java/main com.github.alextokarew.javadebugging.multithreaded.Races
```

```jdb
stop thread at com.github.alextokarew.javadebugging.multithreaded.Races:12
run
threads
thread <thread id 1>
print counter
thread <thread id 2>
print counter
resume
```

# FFM API debugging

## Building and running
At the project root:
```bash
./gradlew clean build
./gradlew :app:run -Dexec.mainClass=com.github.alextokarew.javadebugging.ffm.FibFFM
```

```
gcc -g -o0 -shared -fpic -o libfibffm.so -I${JAVA_HOME}/include -I${JAVA_HOME}/include/linux fibffm.cpp

javac -g --enable-preview --release 21 com/github/alextokarew/joker/jvmdebug/FibFFM.java
java --enable-preview --enable-native-access=ALL-UNNAMED com.github.alextokarew.javadebugging.ffm.FibFFM

java --enable-preview --enable-native-access=ALL-UNNAMED -agentlib:jdwp=transport=dt_socket,server=y,suspend=y,address=5005 com.github.alextokarew.javadebugging.ffm.FibFFM
```
